<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admintrastor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <link rel="stylesheet" href="/stylesheets/index.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"></script>
</head>

<body>
  <form class="product-manage" action="<%=originUrl.length <= 1 ? originUrl : originUrl + '&'%>"
    onsubmit="disableEmptyInputs(this)" method="get">
    <div class="product-manage">
      <header class="p-3 mb-3 border-bottom">
        <div class="container">
          <div class="d-flex flex-wrap align-items-sm-start justify-content-lg-start justify-content-lg-start">
            <p style="font-size: 30px; align-items:flex-start;">TRANG QUẢN LÝ</p>
            <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">

            </ul>
            <div class="dropdown text-end">
              <a href="#" class="d-block link-dark text-decoration-none dropdown-toggle" data-bs-toggle="dropdown"
                aria-expanded="false">

                <img src="<%= ava ? ava : '/images/profile-icon.png' %>" alt="mdo" width="32" height="32"
                  class="rounded-circle">
              </a>
              <ul class="dropdown-menu text-small">
                <li><a class="dropdown-item" href="/admin-profile/<%= user.id %> ">Hồ sơ</a></li>
                <li><a class="dropdown-item" href="/logout">Đăng xuất</a></li>
              </ul>
            </div>
            <div>&nbsp&nbsp&nbsp</div>
            <p class="admin">
              <%= user.username %>
            </p>

          </div>
        </div>
      </header>


      <div class="container-fluid">
        <div class="row flex-nowrap">
          <div class="col-auto col-md-3 col-xl-2 px-sm-2 px-0 bg-white">
            <div class="d-flex flex-column align-items-center align-items-sm-start px-3 pt-2 text-white min-vh-100">
              <a href="/static"
                class="d-flex align-items-center pb-3 mb-md-0 me-md-auto text-black text-decoration-none">
                <span class="fs-5 d-none d-sm-inline">Menu</span>
              </a>
              <ul class="nav nav-pills flex-column mb-sm-auto mb-0 align-items-center align-items-sm-start" id="menu">
                <li class="nav-item">
                  <a href="/users-manage " class="nav-link align-middle px-0 text-black">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                      class="bi bi-people" viewBox="0 0 16 16">
                      <path
                        d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1h8Zm-7.978-1A.261.261 0 0 1 7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002a.274.274 0 0 1-.014.002H7.022ZM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM6.936 9.28a5.88 5.88 0 0 0-1.23-.247A7.35 7.35 0 0 0 5 9c-4 0-5 3-5 4 0 .667.333 1 1 1h4.216A2.238 2.238 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816ZM4.92 10A5.493 5.493 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0Zm3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z" />
                    </svg><i class="fs-4 bi-house"></i><span class="ms-1 d-none d-sm-inline">Quản lí người dùng</span>
                  </a>
                </li>
                <li>
                  <a href="/product-manage " class="nav-link px-0 align-middle text-blue">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bag"
                      viewBox="0 0 16 16">
                      <path
                        d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1zm3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4h-3.5zM2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V5z" />
                    </svg><i class="fs-4 bi-table"></i> <span class="ms-1 d-none d-sm-inline">Quản lí sản
                      phẩm</span></a>
                </li>
                <li>
                  <a href="/orders-manage " class="nav-link px-0 align-middle text-black">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                      class="bi bi-cart-check" viewBox="0 0 16 16">
                      <path
                        d="M11.354 6.354a.5.5 0 0 0-.708-.708L8 8.293 6.854 7.146a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3z" />
                      <path
                        d="M.5 1a.5.5 0 0 0 0 1h1.11l.401 1.607 1.498 7.985A.5.5 0 0 0 4 12h1a2 2 0 1 0 0 4 2 2 0 0 0 0-4h7a2 2 0 1 0 0 4 2 2 0 0 0 0-4h1a.5.5 0 0 0 .491-.408l1.5-8A.5.5 0 0 0 14.5 3H2.89l-.405-1.621A.5.5 0 0 0 2 1H.5zm3.915 10L3.102 4h10.796l-1.313 7h-8.17zM6 14a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm7 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z" />
                    </svg><i class="fs-4 bi-table"></i> <span class="ms-1 d-none d-sm-inline">Quản lí đơn đặt
                      hàng</span></a>
                </li>
                <li>
                  <a href="/origin-manage " class="nav-link px-0 align-middle text-black">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                      class="bi bi-box-seam-fill" viewBox="0 0 16 16">
                      <path fill-rule="evenodd"
                        d="M15.528 2.973a.75.75 0 0 1 .472.696v8.662a.75.75 0 0 1-.472.696l-7.25 2.9a.75.75 0 0 1-.557 0l-7.25-2.9A.75.75 0 0 1 0 12.331V3.669a.75.75 0 0 1 .471-.696L7.443.184l.01-.003.268-.108a.75.75 0 0 1 .558 0l.269.108.01.003 6.97 2.789ZM10.404 2 4.25 4.461 1.846 3.5 1 3.839v.4l6.5 2.6v7.922l.5.2.5-.2V6.84l6.5-2.6v-.4l-.846-.339L8 5.961 5.596 5l6.154-2.461L10.404 2Z" />
                    </svg><i class="fs-4 bi-table"></i> <span class="ms-1 d-none d-sm-inline">Quản lí nơi
                      sản xuất</span></a>
                </li>
                <li>
                  <a href="/type-manage " class="nav-link px-0 align-middle text-black">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                      class="bi bi-grid-3x3-gap" viewBox="0 0 16 16">
                      <path
                        d="M4 2v2H2V2h2zm1 12v-2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1zm0-5V7a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1zm0-5V2a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1zm5 10v-2a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1zm0-5V7a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1zm0-5V2a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1zM9 2v2H7V2h2zm5 0v2h-2V2h2zM4 7v2H2V7h2zm5 0v2H7V7h2zm5 0h-2v2h2V7zM4 12v2H2v-2h2zm5 0v2H7v-2h2zm5 0v2h-2v-2h2zM12 1a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1h-2zm-1 6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V7zm1 4a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1h-2z" />
                    </svg><i class="fs-4 bi-table"></i> <span class="ms-1 d-none d-sm-inline">Quản lí thể
                      loại</span></a>
                </li>
                <li>
                  <a href="/static " class="nav-link px-0 align-middle text-black">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                      class="bi bi-journals" viewBox="0 0 16 16">
                      <path
                        d="M5 0h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2 2 2 0 0 1-2 2H3a2 2 0 0 1-2-2h1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1H1a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v9a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H5a1 1 0 0 0-1 1H3a2 2 0 0 1 2-2z" />
                      <path
                        d="M1 6v-.5a.5.5 0 0 1 1 0V6h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V9h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 2.5v.5H.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1H2v-.5a.5.5 0 0 0-1 0z" />
                    </svg><i class="fs-4 bi-table"></i> <span class="ms-1 d-none d-sm-inline">Báo
                      cáo</span></a>
                </li>
              </ul>
              <hr>
            </div>
          </div>
          <div class="col table-products">
            <!--SORT USER-MANAGE -->
            <div class="sort-list">
              <div class="p-3" style="background-color: white;">
                <span class="mx-2">Sắp xếp theo</span>
                <div class="d-inline-block">
                  <input type="submit" placeholder="Tên sản phẩm" name="sortName" id="sort-name" value="Tên sản phẩm"
                    readonly>
                  <input type="submit" placeholder="Loại sản phẩm" name="sortType" id="sort-type" value="Loại sản phẩm"
                    readonly>
                  <input type="submit" placeholder="Lượt mua" name="sortNumbuy" id="sort-numbuy" value="Lượt mua"
                    readonly>
                  <input type="submit" placeholder="Ngày tạo" name="sortCreateon" id="sort-createon" value="Ngày tạo"
                    readonly>
                  <select id="select-sort" name="sort">
                    <option value="up">Thấp đến cao</option>
                    <option value="down">Cao đến thấp</option>
                  </select>
                </div>
              </div>
            </div>
            <!--SORT USER-MANAGE-->
            <br>
            <div class="d-flex justify-content-center">
              <h3>Bảng quản lí sản phẩm</h3>
            </div>
            <br>
            <table class="table table-striped">
              <thead>
                <tr>
                  <th scope="col">STT</th>
                  <th scope="col">Tên sản phẩm</th>
                  <th scope="col">Loại sản phẩm</th>
                  <th scope="col">Ngày tạo</th>
                  <th scope="col">Giá (vnđ)</th>
                  <th scope="col">Lượt mua</th>
                  <th scope="col">Chỉnh sửa</th>
                  <th scope="col">Xóa</th>
                </tr>
              </thead>
              <tbody class="list list-products">
                <% for(var i=0; i< listProduct.length; i++) {%>
                  <tr>
                    <th>
                      <%=i+1%>
                    </th>
                    <td>
                      <%= listProduct[i].NAMEPRODUCT.length> 20 ? listProduct[i].NAMEPRODUCT.slice(0, 40) +
                        `...` : listProduct[i].NAMEPRODUCT %>
                    </td>
                    <td>
                      <%=listProduct[i].NAMETYPE %>
                    </td>
                    <td>
                      <%=listProduct[i].CREATEON.toString().slice(10, 15)%>
                    </td>
                    <td>
                      <%=listProduct[i].PRICE%>
                    </td>
                    <td>
                      <%=listProduct[i].NUMBUY%>
                    </td>
                    <td>
                      <a class="py-3" href="/manage/details-product/<%= listProduct[i].IDPRODUCT%>"
                        style="opacity: 1; background-color: transparent;">
                        <button type="button" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#exampleModal"
                          style="text-decoration:underline; color: red;opacity: 1;">
                          Chỉnh sửa
                        </button>
                      </a>
                    </td>
                    <td scope="col">
                      <a class="py-3" href="/product-manage/<%=listProduct[i].IDPRODUCT%>/delete-info">
                        <button type="button" class="btn btn-secondary">
                          Xóa
                        </button>
                      </a>
                    </td>
                  </tr>
                  <%}%>
          </div>
          </table>
          <br>
          <!--  -->
          <div class="d-flex justify-content-center"><a class="py-3" href="/admin-add-product"><button type="button"
                class="btn btn-secondary">
                Thêm sản phẩm
              </button></a></div>
          <!--  -->

          <br>
          <!-- PAGING -->
          <% if(pagination_info.total_pages> 1) { %>
            <div class="paging-list-product text-center py-5 fs-5">
              <% if (pagination_info.current_page> 1) {%>
                <button id="<%=pagination_info.current_page-1%>" class="paging-btn">&laquo;</button>
                <% } %>
                  <% for (var i=iterator; i <=endingLink; i++) {%>
                    <% if (pagination_info.current_page===i) {%>
                      <button id="<%= i %>" class="active paging-btn">
                        <%=i%>
                      </button>
                      <% } else { %>
                        <button id="<%= i %>" class="paging-btn">
                          <%=i%>
                        </button>
                        <% } %>

                          <% } %>
                            <% if (endingLink < pagination_info.total_pages) {%>
                              <button id="<%=pagination_info.current_page+1%>" class="paging-btn">&raquo;</button>
                              <% } %>
            </div>
            <% } %>
        </div>
      </div>
    </div>

    </div>
  </form>
</body>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
  $('.table-products').on('click', '.paging-btn', function (event) {
    event.preventDefault();
    loadProductPage($(this).prop('id'), "<%= originUrl %>");
  });
  function loadProductPage(page, originUrl) {
    originUrl = originUrl.replaceAll("&amp;", "&");
    let url = `api/product-manage/` + `?page=${page}`;
    if (originUrl.length > 1) url = `api/product-manage/` + originUrl + `&page=${page}`;
    $.getJSON(url, function (result) {
      //console.log(page, " ", result.pagination_info)
      $('.list-products').empty();

      //UPDATE LIST-REVIEW
      $.each(result.listProduct, (key, value) => {
        var item = $('<tr></tr>');
        var elemsToAppend = $('<th>' + value.IDPRODUCT + '</th>');
        item.append(elemsToAppend);
        elemsToAppend = $('<td>' + value.NAMEPRODUCT + '</td>');
        item.append(elemsToAppend);
        elemsToAppend = $('<td>' + value.NAMETYPE + '</td>');
        item.append(elemsToAppend);
        elemsToAppend = $('<td>' + value.CREATEON.toString().slice(0, 10) + '</td>');
        item.append(elemsToAppend);
        elemsToAppend = $('<td>' + value.PRICE + '</td>');
        item.append(elemsToAppend);
        elemsToAppend = $('<td>' + value.NUMBUY + '</td>');
        item.append(elemsToAppend);
        elemsToAppend = $('<td></td>');
        var inner1 = $('<a class="py-3" href="/manage/details-product/' + value.IDPRODUCT + '"style = "opacity: 1; background-color: transparent;"></a>');
        var inner2 = $('<button type="button" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#exampleModal" style="text-decoration:underline; color: red;opacity: 1;">Chỉnh sửa</button>');
        inner1.append(inner2);
        elemsToAppend.append(inner1);
        item.append(elemsToAppend);

        elemsToAppend = $('<th scope="col"></th>');
        inner1 = $('<a class="py-3" href="/product-manage/' + value.IDPRODUCT + '/delete-info"></a>')
        inner2 = $('<button type="button" class="btn btn-secondary">Xóa</button>');
        inner1.append(inner2);
        elemsToAppend.append(inner1);
        item.append(elemsToAppend);

        $(".list-products").append(item);

      })
      //UPDATE PAGING
      $('.paging-list-product').empty();
      if (result.pagination_info.total_pages > 1) {
        var item = $('<div class="paging text-center py-5 fs-5"></div>');
        if (result.pagination_info.current_page > 1) {
          const page = result.pagination_info.current_page - 1;
          item.append('<button id="' + page + '" class="paging-btn">&laquo;</button>');
        }
        for (let i = result.iterator; i <= result.endingLink; i++) {
          if (result.pagination_info.current_page === i)
            item.append('<button id="' + i + '" class="active paging-btn">' + i + '</button>');
          else
            item.append('<button id="' + i + '" class="paging-btn">' + i + '</button>');
        }
        if (result.endingLink < result.pagination_info.total_pages) {
          const page = result.pagination_info.current_page + 1;
          item.append('<button id="' + page + '" class="paging-btn">&raquo;</button>');
        }
        $(".paging-list-product").append(item);
      }
    });
  }
  function disableEmptyInputs(form) {
    var controls = form.elements;
    for (var i = 0, iLen = controls.length; i < iLen; i++) {
      if (controls[i].value == '') controls[i].disabled = true;
    }
  }
</script>

</html>